!function(){function Chunks(){}function PanelCollection(postfix){this.buttonBar=doc.getElementById("wmd-button-bar"+postfix),this.preview=doc.getElementById("wmd-preview"+postfix),this.input=doc.getElementById("wmd-input"+postfix)}function UndoManager(callback,panels){var lastState,timer,inputStateObj,undoObj=this,undoStack=[],stackPtr=0,mode="none",setMode=function(newMode,noSave){mode!=newMode&&(mode=newMode,noSave||saveState()),uaSniffed.isIE&&"moving"==mode?inputStateObj=null:timer=setTimeout(refreshState,1)},refreshState=function(isInitialState){inputStateObj=new TextareaState(panels,isInitialState),timer=void 0};this.setCommandMode=function(){mode="command",saveState(),timer=setTimeout(refreshState,0)},this.canUndo=function(){return stackPtr>1},this.canRedo=function(){return!!undoStack[stackPtr+1]},this.undo=function(){undoObj.canUndo()&&(lastState?(lastState.restore(),lastState=null):(undoStack[stackPtr]=new TextareaState(panels),undoStack[--stackPtr].restore(),callback&&callback())),mode="none",panels.input.focus(),refreshState()},this.redo=function(){undoObj.canRedo()&&(undoStack[++stackPtr].restore(),callback&&callback()),mode="none",panels.input.focus(),refreshState()};var saveState=function(){var currState=inputStateObj||new TextareaState(panels);return!!currState&&("moving"==mode?void(lastState||(lastState=currState)):(lastState&&(undoStack[stackPtr-1].text!=lastState.text&&(undoStack[stackPtr++]=lastState),lastState=null),undoStack[stackPtr++]=currState,undoStack[stackPtr+1]=null,void(callback&&callback())))},handleCtrlYZ=function(event){var handled=!1;if((event.ctrlKey||event.metaKey)&&!event.altKey){var keyCode=event.charCode||event.keyCode;switch(String.fromCharCode(keyCode).toLowerCase()){case"y":undoObj.redo(),handled=!0;break;case"z":event.shiftKey?undoObj.redo():undoObj.undo(),handled=!0}}if(handled)return event.preventDefault&&event.preventDefault(),void(window.event&&(window.event.returnValue=!1))},handleModeChange=function(event){if(!event.ctrlKey&&!event.metaKey){var keyCode=event.keyCode;keyCode>=33&&keyCode<=40||keyCode>=63232&&keyCode<=63235?setMode("moving"):8==keyCode||46==keyCode||127==keyCode?setMode("deleting"):13==keyCode?setMode("newlines"):27==keyCode?setMode("escape"):(keyCode<16||keyCode>20)&&91!=keyCode&&setMode("typing")}},setEventHandlers=function(){util.addEvent(panels.input,"keypress",function(event){!event.ctrlKey&&!event.metaKey||event.altKey||89!=event.keyCode&&90!=event.keyCode||event.preventDefault()});var handlePaste=function(){(uaSniffed.isIE||inputStateObj&&inputStateObj.text!=panels.input.value)&&void 0==timer&&(mode="paste",saveState(),refreshState())};util.addEvent(panels.input,"keydown",handleCtrlYZ),util.addEvent(panels.input,"keydown",handleModeChange),util.addEvent(panels.input,"mousedown",function(){setMode("moving")}),panels.input.onpaste=handlePaste,panels.input.ondrop=handlePaste};!function(){setEventHandlers(),refreshState(!0),saveState()}()}function TextareaState(panels,isInitialState){var stateObj=this,inputArea=panels.input;this.init=function(){util.isVisible(inputArea)&&(!isInitialState&&doc.activeElement&&doc.activeElement!==inputArea||(this.setInputAreaSelectionStartEnd(),this.scrollTop=inputArea.scrollTop,(!this.text&&inputArea.selectionStart||0===inputArea.selectionStart)&&(this.text=inputArea.value)))},this.setInputAreaSelection=function(){if(util.isVisible(inputArea))if(void 0===inputArea.selectionStart||uaSniffed.isOpera){if(doc.selection){if(doc.activeElement&&doc.activeElement!==inputArea)return;inputArea.focus();var range=inputArea.createTextRange();range.moveStart("character",-inputArea.value.length),range.moveEnd("character",-inputArea.value.length),range.moveEnd("character",stateObj.end),range.moveStart("character",stateObj.start),range.select()}}else inputArea.focus(),inputArea.selectionStart=stateObj.start,inputArea.selectionEnd=stateObj.end,inputArea.scrollTop=stateObj.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(panels.ieCachedRange||!inputArea.selectionStart&&0!==inputArea.selectionStart){if(doc.selection){stateObj.text=util.fixEolChars(inputArea.value);var range=panels.ieCachedRange||doc.selection.createRange(),fixedRange=util.fixEolChars(range.text),marker="",markedRange=marker+fixedRange+marker;range.text=markedRange;var inputText=util.fixEolChars(inputArea.value);range.moveStart("character",-markedRange.length),range.text=fixedRange,stateObj.start=inputText.indexOf(marker),stateObj.end=inputText.lastIndexOf(marker)-marker.length;var len=stateObj.text.length-util.fixEolChars(inputArea.value).length;if(len){for(range.moveStart("character",-fixedRange.length);len--;)fixedRange+="\n",stateObj.end+=1;range.text=fixedRange}panels.ieCachedRange&&(stateObj.scrollTop=panels.ieCachedScrollTop),panels.ieCachedRange=null,this.setInputAreaSelection()}}else stateObj.start=inputArea.selectionStart,stateObj.end=inputArea.selectionEnd},this.restore=function(){void 0!=stateObj.text&&stateObj.text!=inputArea.value&&(inputArea.value=stateObj.text),this.setInputAreaSelection(),inputArea.scrollTop=stateObj.scrollTop},this.getChunks=function(){var chunk=new Chunks;return chunk.before=util.fixEolChars(stateObj.text.substring(0,stateObj.start)),chunk.startTag="",chunk.selection=util.fixEolChars(stateObj.text.substring(stateObj.start,stateObj.end)),chunk.endTag="",chunk.after=util.fixEolChars(stateObj.text.substring(stateObj.end)),chunk.scrollTop=stateObj.scrollTop,chunk},this.setChunks=function(chunk){chunk.before=chunk.before+chunk.startTag,chunk.after=chunk.endTag+chunk.after,this.start=chunk.before.length,this.end=chunk.before.length+chunk.selection.length,this.text=chunk.before+chunk.selection+chunk.after,this.scrollTop=chunk.scrollTop},this.init()}function PreviewManager(converter,panels,previewRefreshCallback){var timeout,elapsedTime,oldInputText,maxDelay=3e3,startType="delayed",setupEvents=function(inputElem,listener){util.addEvent(inputElem,"input",listener),inputElem.onpaste=listener,inputElem.ondrop=listener,util.addEvent(inputElem,"keypress",listener),util.addEvent(inputElem,"keydown",listener)},getDocScrollTop=function(){var result=0;return window.innerHeight?result=window.pageYOffset:doc.documentElement&&doc.documentElement.scrollTop?result=doc.documentElement.scrollTop:doc.body&&(result=doc.body.scrollTop),result},makePreviewHtml=function(){if(panels.preview){var text=panels.input.value;if(!text||text!=oldInputText){oldInputText=text;var prevTime=(new Date).getTime();text=converter.makeHtml(text);var currTime=(new Date).getTime();elapsedTime=currTime-prevTime,pushPreviewHtml(text)}}},applyTimeout=function(){if(timeout&&(clearTimeout(timeout),timeout=void 0),"manual"!==startType){var delay=0;"delayed"===startType&&(delay=elapsedTime),delay>maxDelay&&(delay=maxDelay),timeout=setTimeout(makePreviewHtml,delay)}},getScaleFactor=function(panel){return panel.scrollHeight<=panel.clientHeight?1:panel.scrollTop/(panel.scrollHeight-panel.clientHeight)},setPanelScrollTops=function(){panels.preview&&(panels.preview.scrollTop=(panels.preview.scrollHeight-panels.preview.clientHeight)*getScaleFactor(panels.preview))};this.refresh=function(requiresRefresh){requiresRefresh?(oldInputText="",makePreviewHtml()):applyTimeout()},this.processingTime=function(){return elapsedTime};var previewSetter,isFirstTimeFilled=!0,ieSafePreviewSet=function(text){var preview=panels.preview,parent=preview.parentNode,sibling=preview.nextSibling;parent.removeChild(preview),preview.innerHTML=text,sibling?parent.insertBefore(preview,sibling):parent.appendChild(preview)},nonSuckyBrowserPreviewSet=function(text){panels.preview.innerHTML=text},previewSet=function(text){if(previewSetter)return previewSetter(text);try{nonSuckyBrowserPreviewSet(text),previewSetter=nonSuckyBrowserPreviewSet}catch(e){previewSetter=ieSafePreviewSet,previewSetter(text)}},pushPreviewHtml=function(text){var emptyTop=position.getTop(panels.input)-getDocScrollTop();if(panels.preview&&(previewSet(text),previewRefreshCallback()),setPanelScrollTops(),isFirstTimeFilled)return void(isFirstTimeFilled=!1);var fullTop=position.getTop(panels.input)-getDocScrollTop();uaSniffed.isIE?setTimeout(function(){window.scrollBy(0,fullTop-emptyTop)},0):window.scrollBy(0,fullTop-emptyTop)};!function(){setupEvents(panels.input,applyTimeout),makePreviewHtml(),panels.preview&&(panels.preview.scrollTop=0)}()}function UIManager(postfix,panels,undoManager,previewManager,commandManager,helpOptions,getString){function doClick(button){if(inputBox.focus(),button.textOp){undoManager&&undoManager.setCommandMode();var state=new TextareaState(panels);if(!state)return;var chunks=state.getChunks(),fixupInputArea=function(){inputBox.focus(),chunks&&state.setChunks(chunks),state.restore(),previewManager.refresh()};button.textOp(chunks,fixupInputArea)||fixupInputArea()}button.execute&&button.execute(undoManager)}function setupButton(button,isEnabled){var normalYShift="0px",image=button.getElementsByTagName("span")[0];isEnabled?(image.style.backgroundPosition=button.XShift+" "+normalYShift,button.onmouseover=function(){image.style.backgroundPosition=this.XShift+" -40px"},button.onmouseout=function(){image.style.backgroundPosition=this.XShift+" "+normalYShift},uaSniffed.isIE&&(button.onmousedown=function(){doc.activeElement&&doc.activeElement!==panels.input||(panels.ieCachedRange=document.selection.createRange(),panels.ieCachedScrollTop=panels.input.scrollTop)}),button.isHelp||(button.onclick=function(){return this.onmouseout&&this.onmouseout(),doClick(this),!1})):(image.style.backgroundPosition=button.XShift+" -20px",button.onmouseover=button.onmouseout=button.onclick=function(){})}function bindCommand(method){return"string"==typeof method&&(method=commandManager[method]),function(){method.apply(commandManager,arguments)}}function makeSpritedButtonRow(){var buttonBar=panels.buttonBar,buttonRow=document.createElement("ul");buttonRow.id="wmd-button-row"+postfix,buttonRow.className="wmd-button-row",buttonRow=buttonBar.appendChild(buttonRow);var xPosition=0,makeButton=function(id,title,XShift,textOp){var button=document.createElement("li");button.className="wmd-button",button.style.left=xPosition+"px",xPosition+=25;var buttonImage=document.createElement("span");return button.id=id+postfix,button.appendChild(buttonImage),button.title=title,button.XShift=XShift,textOp&&(button.textOp=textOp),setupButton(button,!0),buttonRow.appendChild(button),button},makeSpacer=function(num){var spacer=document.createElement("li");spacer.className="wmd-spacer wmd-spacer"+num,spacer.id="wmd-spacer"+num+postfix,buttonRow.appendChild(spacer),xPosition+=25};buttons.bold=makeButton("wmd-bold-button",getString("bold"),"0px",bindCommand("doBold")),buttons.italic=makeButton("wmd-italic-button",getString("italic"),"-20px",bindCommand("doItalic")),makeSpacer(1),buttons.link=makeButton("wmd-link-button",getString("link"),"-40px",bindCommand(function(chunk,postProcessing){return this.doLinkOrImage(chunk,postProcessing,!1)})),buttons.quote=makeButton("wmd-quote-button",getString("quote"),"-60px",bindCommand("doBlockquote")),buttons.code=makeButton("wmd-code-button",getString("code"),"-80px",bindCommand("doCode")),buttons.image=makeButton("wmd-image-button",getString("image"),"-100px",bindCommand(function(chunk,postProcessing){return this.doLinkOrImage(chunk,postProcessing,!0)})),makeSpacer(2),buttons.olist=makeButton("wmd-olist-button",getString("olist"),"-120px",bindCommand(function(chunk,postProcessing){this.doList(chunk,postProcessing,!0)})),buttons.ulist=makeButton("wmd-ulist-button",getString("ulist"),"-140px",bindCommand(function(chunk,postProcessing){this.doList(chunk,postProcessing,!1)})),buttons.heading=makeButton("wmd-heading-button",getString("heading"),"-160px",bindCommand("doHeading")),buttons.hr=makeButton("wmd-hr-button",getString("hr"),"-180px",bindCommand("doHorizontalRule")),makeSpacer(3),buttons.undo=makeButton("wmd-undo-button",getString("undo"),"-200px",null),buttons.undo.execute=function(manager){manager&&manager.undo()};var redoTitle=getString(/win/.test(nav.platform.toLowerCase())?"redo":"redomac");if(buttons.redo=makeButton("wmd-redo-button",redoTitle,"-220px",null),buttons.redo.execute=function(manager){manager&&manager.redo()},helpOptions){var helpButton=document.createElement("li"),helpButtonImage=document.createElement("span");helpButton.appendChild(helpButtonImage),helpButton.className="wmd-button wmd-help-button",helpButton.id="wmd-help-button"+postfix,helpButton.XShift="-240px",helpButton.isHelp=!0,helpButton.style.right="0px",helpButton.title=getString("help"),helpButton.onclick=helpOptions.handler,setupButton(helpButton,!0),buttonRow.appendChild(helpButton),buttons.help=helpButton}setUndoRedoButtonStates()}function setUndoRedoButtonStates(){undoManager&&(setupButton(buttons.undo,undoManager.canUndo()),setupButton(buttons.redo,undoManager.canRedo()))}var inputBox=panels.input,buttons={};makeSpritedButtonRow();var keyEvent="keydown";uaSniffed.isOpera&&(keyEvent="keypress"),util.addEvent(inputBox,keyEvent,function(key){if((key.ctrlKey||key.metaKey)&&!key.altKey&&!key.shiftKey){var keyCode=key.charCode||key.keyCode;switch(String.fromCharCode(keyCode).toLowerCase()){case"b":doClick(buttons.bold);break;case"i":doClick(buttons.italic);break;case"l":doClick(buttons.link);break;case"q":doClick(buttons.quote);break;case"k":doClick(buttons.code);break;case"g":doClick(buttons.image);break;case"o":doClick(buttons.olist);break;case"u":doClick(buttons.ulist);break;case"h":doClick(buttons.heading);break;case"r":doClick(buttons.hr);break;case"y":doClick(buttons.redo);break;case"z":doClick(key.shiftKey?buttons.redo:buttons.undo);break;default:return}key.preventDefault&&key.preventDefault(),window.event&&(window.event.returnValue=!1)}}),util.addEvent(inputBox,"keyup",function(key){if(key.shiftKey&&!key.ctrlKey&&!key.metaKey){if(13===(key.charCode||key.keyCode)){var fakeButton={};fakeButton.textOp=bindCommand("doAutoindent"),doClick(fakeButton)}}}),uaSniffed.isIE&&util.addEvent(inputBox,"keydown",function(key){if(27===key.keyCode)return!1}),this.setUndoRedoButtonStates=setUndoRedoButtonStates}function CommandManager(pluginHooks,getString){this.hooks=pluginHooks,this.getString=getString}function properlyEncoded(linkdef){return linkdef.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(wholematch,link,title){return link=link.replace(/\?.*$/,function(querypart){return querypart.replace(/\+/g," ")}),link=decodeURIComponent(link),link=encodeURI(link).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"),link=link.replace(/\?.*$/,function(querypart){return querypart.replace(/\+/g,"%2b")}),title&&(title=title.trim?title.trim():title.replace(/^\s*/,"").replace(/\s*$/,""),title=title.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),title?link+' "'+title+'"':link})}var util={},position={},ui={},doc=window.document,re=window.RegExp,nav=window.navigator,SETTINGS={lineLength:72},uaSniffed={isIE:/msie/.test(nav.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(nav.userAgent.toLowerCase())||/msie 5/.test(nav.userAgent.toLowerCase()),isOpera:/opera/.test(nav.userAgent.toLowerCase())},defaultsStrings={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"},imageDefaultText="http://",linkDefaultText="http://";Markdown.Editor=function(markdownConverter,idPostfix,options){options=options||{},"function"==typeof options.handler&&(options={helpButton:options}),options.strings=options.strings||{},options.helpButton&&(options.strings.help=options.strings.help||options.helpButton.title);var getString=function(identifier){return options.strings[identifier]||defaultsStrings[identifier]};idPostfix=idPostfix||"";var hooks=this.hooks=new Markdown.HookCollection;hooks.addNoop("onPreviewRefresh"),hooks.addNoop("postBlockquoteCreation"),hooks.addFalse("insertImageDialog"),this.getConverter=function(){return markdownConverter};var panels,that=this;this.run=function(){if(!panels){panels=new PanelCollection(idPostfix);var undoManager,uiManager,commandManager=new CommandManager(hooks,getString),previewManager=new PreviewManager(markdownConverter,panels,function(){hooks.onPreviewRefresh()});/\?noundo/.test(doc.location.href)||(undoManager=new UndoManager(function(){previewManager.refresh(),uiManager&&uiManager.setUndoRedoButtonStates()},panels),this.textOperation=function(f){undoManager.setCommandMode(),f(),that.refreshPreview()}),uiManager=new UIManager(idPostfix,panels,undoManager,previewManager,commandManager,options.helpButton,getString),uiManager.setUndoRedoButtonStates();(that.refreshPreview=function(){previewManager.refresh(!0)})()}}},Chunks.prototype.findTags=function(startRegex,endRegex){var regex,chunkObj=this;startRegex&&(regex=util.extendRegExp(startRegex,"","$"),this.before=this.before.replace(regex,function(match){return chunkObj.startTag=chunkObj.startTag+match,""}),regex=util.extendRegExp(startRegex,"^",""),this.selection=this.selection.replace(regex,function(match){return chunkObj.startTag=chunkObj.startTag+match,""})),endRegex&&(regex=util.extendRegExp(endRegex,"","$"),this.selection=this.selection.replace(regex,function(match){return chunkObj.endTag=match+chunkObj.endTag,""}),regex=util.extendRegExp(endRegex,"^",""),this.after=this.after.replace(regex,function(match){return chunkObj.endTag=match+chunkObj.endTag,""}))},Chunks.prototype.trimWhitespace=function(remove){var beforeReplacer,afterReplacer,that=this;remove?beforeReplacer=afterReplacer="":(beforeReplacer=function(s){return that.before+=s,""},afterReplacer=function(s){return that.after=s+that.after,""}),this.selection=this.selection.replace(/^(\s*)/,beforeReplacer).replace(/(\s*)$/,afterReplacer)},Chunks.prototype.skipLines=function(nLinesBefore,nLinesAfter,findExtraNewlines){void 0===nLinesBefore&&(nLinesBefore=1),void 0===nLinesAfter&&(nLinesAfter=1),nLinesBefore++,nLinesAfter++;var regexText,replacementText;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+re.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+re.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+re.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+re.$1,this.before){for(regexText=replacementText="";nLinesBefore--;)regexText+="\\n?",replacementText+="\n";findExtraNewlines&&(regexText="\\n*"),this.before=this.before.replace(new re(regexText+"$",""),replacementText)}if(this.after){for(regexText=replacementText="";nLinesAfter--;)regexText+="\\n?",replacementText+="\n";findExtraNewlines&&(regexText="\\n*"),this.after=this.after.replace(new re(regexText,""),replacementText)}},util.isVisible=function(elem){return window.getComputedStyle?"none"!==window.getComputedStyle(elem,null).getPropertyValue("display"):elem.currentStyle?"none"!==elem.currentStyle.display:void 0},util.addEvent=function(elem,event,listener){elem.attachEvent?elem.attachEvent("on"+event,listener):elem.addEventListener(event,listener,!1)},util.removeEvent=function(elem,event,listener){elem.detachEvent?elem.detachEvent("on"+event,listener):elem.removeEventListener(event,listener,!1)},util.fixEolChars=function(text){return text=text.replace(/\r\n/g,"\n"),text=text.replace(/\r/g,"\n")},util.extendRegExp=function(regex,pre,post){null!==pre&&void 0!==pre||(pre=""),null!==post&&void 0!==post||(post="");var flags,pattern=regex.toString();return pattern=pattern.replace(/\/([gim]*)$/,function(wholeMatch,flagsPart){return flags=flagsPart,""}),pattern=pattern.replace(/(^\/|\/$)/g,""),pattern=pre+pattern+post,new re(pattern,flags)},position.getTop=function(elem,isInner){var result=elem.offsetTop;if(!isInner)for(;elem=elem.offsetParent;)result+=elem.offsetTop;return result},position.getHeight=function(elem){return elem.offsetHeight||elem.scrollHeight},position.getWidth=function(elem){return elem.offsetWidth||elem.scrollWidth},position.getPageSize=function(){var scrollWidth,scrollHeight,innerWidth,innerHeight;return self.innerHeight&&self.scrollMaxY?(scrollWidth=doc.body.scrollWidth,scrollHeight=self.innerHeight+self.scrollMaxY):doc.body.scrollHeight>doc.body.offsetHeight?(scrollWidth=doc.body.scrollWidth,scrollHeight=doc.body.scrollHeight):(scrollWidth=doc.body.offsetWidth,scrollHeight=doc.body.offsetHeight),self.innerHeight?(innerWidth=self.innerWidth,innerHeight=self.innerHeight):doc.documentElement&&doc.documentElement.clientHeight?(innerWidth=doc.documentElement.clientWidth,innerHeight=doc.documentElement.clientHeight):doc.body&&(innerWidth=doc.body.clientWidth,innerHeight=doc.body.clientHeight),[Math.max(scrollWidth,innerWidth),Math.max(scrollHeight,innerHeight),innerWidth,innerHeight]},ui.createBackground=function(){var background=doc.createElement("div"),style=background.style;background.className="wmd-prompt-background",style.position="absolute",style.top="0",style.zIndex="1000",uaSniffed.isIE?style.filter="alpha(opacity=50)":style.opacity="0.5";var pageSize=position.getPageSize();return style.height=pageSize[1]+"px",uaSniffed.isIE?(style.left=doc.documentElement.scrollLeft,style.width=doc.documentElement.clientWidth):(style.left="0",style.width="100%"),doc.body.appendChild(background),background},ui.prompt=function(text,defaultInputText,callback){var dialog,input;void 0===defaultInputText&&(defaultInputText="");var checkEscape=function(key){27===(key.charCode||key.keyCode)&&close(!0)},close=function(isCancel){util.removeEvent(doc.body,"keydown",checkEscape);var text=input.value;return isCancel?text=null:(text=text.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(text)||(text="http://"+text)),dialog.parentNode.removeChild(dialog),callback(text),!1},createDialog=function(){dialog=doc.createElement("div"),dialog.className="wmd-prompt-dialog",dialog.style.padding="10px;",dialog.style.position="fixed",dialog.style.width="400px",dialog.style.zIndex="1001";var question=doc.createElement("div");question.innerHTML=text,question.style.padding="5px",dialog.appendChild(question);var form=doc.createElement("form"),style=form.style;form.onsubmit=function(){return close(!1)},style.padding="0",style.margin="0",style.cssFloat="left",style.width="100%",style.textAlign="center",style.position="relative",dialog.appendChild(form),input=doc.createElement("input"),input.type="text",input.value=defaultInputText,style=input.style,style.display="block",style.width="80%",style.marginLeft=style.marginRight="auto",form.appendChild(input);var okButton=doc.createElement("input");okButton.type="button",okButton.onclick=function(){return close(!1)},okButton.value="OK",style=okButton.style,style.margin="10px",style.display="inline",style.width="7em";var cancelButton=doc.createElement("input");cancelButton.type="button",cancelButton.onclick=function(){return close(!0)},cancelButton.value="Cancel",style=cancelButton.style,style.margin="10px",style.display="inline",style.width="7em",form.appendChild(okButton),form.appendChild(cancelButton),util.addEvent(doc.body,"keydown",checkEscape),dialog.style.top="50%",dialog.style.left="50%",dialog.style.display="block",uaSniffed.isIE_5or6&&(dialog.style.position="absolute",dialog.style.top=doc.documentElement.scrollTop+200+"px",dialog.style.left="50%"),doc.body.appendChild(dialog),dialog.style.marginTop=-position.getHeight(dialog)/2+"px",dialog.style.marginLeft=-position.getWidth(dialog)/2+"px"};setTimeout(function(){createDialog();var defTextLen=defaultInputText.length;if(void 0!==input.selectionStart)input.selectionStart=0,input.selectionEnd=defTextLen;else if(input.createTextRange){var range=input.createTextRange();range.collapse(!1),range.moveStart("character",-defTextLen),range.moveEnd("character",defTextLen),range.select()}input.focus()},0)};var commandProto=CommandManager.prototype;commandProto.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",commandProto.unwrap=function(chunk){var txt=new re("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");chunk.selection=chunk.selection.replace(txt,"$1 $2")},commandProto.wrap=function(chunk,len){this.unwrap(chunk);var regex=new re("(.{1,"+len+"})( +|$\\n?)","gm"),that=this;chunk.selection=chunk.selection.replace(regex,function(line,marked){return new re("^"+that.prefixes,"").test(line)?line:marked+"\n"}),chunk.selection=chunk.selection.replace(/\s+$/,"")},commandProto.doBold=function(chunk,postProcessing){return this.doBorI(chunk,postProcessing,2,this.getString("boldexample"))},commandProto.doItalic=function(chunk,postProcessing){return this.doBorI(chunk,postProcessing,1,this.getString("italicexample"))},commandProto.doBorI=function(chunk,postProcessing,nStars,insertText){chunk.trimWhitespace(),chunk.selection=chunk.selection.replace(/\n{2,}/g,"\n");var starsBefore=/(\**$)/.exec(chunk.before)[0],starsAfter=/(^\**)/.exec(chunk.after)[0],prevStars=Math.min(starsBefore.length,starsAfter.length);if(prevStars>=nStars&&(2!=prevStars||1!=nStars))chunk.before=chunk.before.replace(re("[*]{"+nStars+"}$",""),""),chunk.after=chunk.after.replace(re("^[*]{"+nStars+"}",""),"");else if(!chunk.selection&&starsAfter){chunk.after=chunk.after.replace(/^([*_]*)/,""),chunk.before=chunk.before.replace(/(\s?)$/,"");var whitespace=re.$1;chunk.before=chunk.before+starsAfter+whitespace}else{chunk.selection||starsAfter||(chunk.selection=insertText);var markup=nStars<=1?"*":"**";chunk.before=chunk.before+markup,chunk.after=markup+chunk.after}},commandProto.stripLinkDefs=function(text,defsToAdd){return text=text.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(totalMatch,id,link,newlines,title){return defsToAdd[id]=totalMatch.replace(/\s*$/,""),newlines?(defsToAdd[id]=totalMatch.replace(/["(](.+?)[")]$/,""),newlines+title):""})},commandProto.addLinkDef=function(chunk,linkDef){var refNumber=0,defsToAdd={};chunk.before=this.stripLinkDefs(chunk.before,defsToAdd),chunk.selection=this.stripLinkDefs(chunk.selection,defsToAdd),chunk.after=this.stripLinkDefs(chunk.after,defsToAdd);var defs="",regex=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,addDefNumber=function(def){refNumber++,def=def.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+refNumber+"]:"),defs+="\n"+def},getLink=function(wholeMatch,before,inner,afterInner,id,end){return inner=inner.replace(regex,getLink),defsToAdd[id]?(addDefNumber(defsToAdd[id]),before+inner+afterInner+refNumber+end):wholeMatch};chunk.before=chunk.before.replace(regex,getLink),linkDef?addDefNumber(linkDef):chunk.selection=chunk.selection.replace(regex,getLink);var refOut=refNumber;return chunk.after=chunk.after.replace(regex,getLink),chunk.after&&(chunk.after=chunk.after.replace(/\n*$/,"")),chunk.after||(chunk.selection=chunk.selection.replace(/\n*$/,"")),chunk.after+="\n\n"+defs,refOut},commandProto.doLinkOrImage=function(chunk,postProcessing,isImage){chunk.trimWhitespace(),chunk.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var background;if(!(chunk.endTag.length>1&&chunk.startTag.length>0)){if(chunk.selection=chunk.startTag+chunk.selection+chunk.endTag,chunk.startTag=chunk.endTag="",/\n\n/.test(chunk.selection))return void this.addLinkDef(chunk,null);var that=this,linkEnteredCallback=function(link){if(background.parentNode.removeChild(background),null!==link){chunk.selection=(" "+chunk.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var linkDef=" [999]: "+properlyEncoded(link),num=that.addLinkDef(chunk,linkDef);chunk.startTag=isImage?"![":"[",chunk.endTag="]["+num+"]",chunk.selection||(chunk.selection=isImage?that.getString("imagedescription"):that.getString("linkdescription"))}postProcessing()};return background=ui.createBackground(),isImage?this.hooks.insertImageDialog(linkEnteredCallback)||ui.prompt(this.getString("imagedialog"),imageDefaultText,linkEnteredCallback):ui.prompt(this.getString("linkdialog"),linkDefaultText,linkEnteredCallback),!0}chunk.startTag=chunk.startTag.replace(/!?\[/,""),chunk.endTag="",this.addLinkDef(chunk,null)},commandProto.doAutoindent=function(chunk,postProcessing){var commandMgr=this,fakeSelection=!1;chunk.before=chunk.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),chunk.before=chunk.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),chunk.before=chunk.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),chunk.selection||/^[ \t]*(?:\n|$)/.test(chunk.after)||(chunk.after=chunk.after.replace(/^[^\n]*/,function(wholeMatch){return chunk.selection=wholeMatch,""}),fakeSelection=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(chunk.before)&&commandMgr.doList&&commandMgr.doList(chunk),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(chunk.before)&&commandMgr.doBlockquote&&commandMgr.doBlockquote(chunk),/(\n|^)(\t|[ ]{4,}).*\n$/.test(chunk.before)&&commandMgr.doCode&&commandMgr.doCode(chunk),fakeSelection&&(chunk.after=chunk.selection+chunk.after,chunk.selection="")},commandProto.doBlockquote=function(chunk,postProcessing){chunk.selection=chunk.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(totalMatch,newlinesBefore,text,newlinesAfter){return chunk.before+=newlinesBefore,chunk.after=newlinesAfter+chunk.after,text}),chunk.before=chunk.before.replace(/(>[ \t]*)$/,function(totalMatch,blankLine){return chunk.selection=blankLine+chunk.selection,""}),chunk.selection=chunk.selection.replace(/^(\s|>)+$/,""),chunk.selection=chunk.selection||this.getString("quoteexample");var line,match="",leftOver="";if(chunk.before){for(var lines=chunk.before.replace(/\n$/,"").split("\n"),inChain=!1,i=0;i<lines.length;i++){var good=!1;line=lines[i],inChain=inChain&&line.length>0,/^>/.test(line)?(good=!0,!inChain&&line.length>1&&(inChain=!0)):good=!!/^[ \t]*$/.test(line)||inChain,good?match+=line+"\n":(leftOver+=match+line,match="\n")}/(^|\n)>/.test(match)||(leftOver+=match,match="")}chunk.startTag=match,chunk.before=leftOver,chunk.after&&(chunk.after=chunk.after.replace(/^\n?/,"\n")),chunk.after=chunk.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(totalMatch){return chunk.endTag=totalMatch,""});var replaceBlanksInTags=function(useBracket){var replacement=useBracket?"> ":"";chunk.startTag&&(chunk.startTag=chunk.startTag.replace(/\n((>|\s)*)\n$/,function(totalMatch,markdown){return"\n"+markdown.replace(/^[ ]{0,3}>?[ \t]*$/gm,replacement)+"\n"})),chunk.endTag&&(chunk.endTag=chunk.endTag.replace(/^\n((>|\s)*)\n/,function(totalMatch,markdown){return"\n"+markdown.replace(/^[ ]{0,3}>?[ \t]*$/gm,replacement)+"\n"}))};/^(?![ ]{0,3}>)/m.test(chunk.selection)?(this.wrap(chunk,SETTINGS.lineLength-2),chunk.selection=chunk.selection.replace(/^/gm,"> "),replaceBlanksInTags(!0),chunk.skipLines()):(chunk.selection=chunk.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(chunk),replaceBlanksInTags(!1),!/^(\n|^)[ ]{0,3}>/.test(chunk.selection)&&chunk.startTag&&(chunk.startTag=chunk.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(chunk.selection)&&chunk.endTag&&(chunk.endTag=chunk.endTag.replace(/^\n{0,2}/,"\n\n"))),chunk.selection=this.hooks.postBlockquoteCreation(chunk.selection),
/\n/.test(chunk.selection)||(chunk.selection=chunk.selection.replace(/^(> *)/,function(wholeMatch,blanks){return chunk.startTag+=blanks,""}))},commandProto.doCode=function(chunk,postProcessing){var hasTextBefore=/\S[ ]*$/.test(chunk.before);if(!/^[ ]*\S/.test(chunk.after)&&!hasTextBefore||/\n/.test(chunk.selection)){chunk.before=chunk.before.replace(/[ ]{4}$/,function(totalMatch){return chunk.selection=totalMatch+chunk.selection,""});var nLinesBack=1,nLinesForward=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(chunk.before)&&(nLinesBack=0),/^\n(\t|[ ]{4,})/.test(chunk.after)&&(nLinesForward=0),chunk.skipLines(nLinesBack,nLinesForward),chunk.selection?/^[ ]{0,3}\S/m.test(chunk.selection)?/\n/.test(chunk.selection)?chunk.selection=chunk.selection.replace(/^/gm,"    "):chunk.before+="    ":chunk.selection=chunk.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(chunk.startTag="    ",chunk.selection=this.getString("codeexample"))}else chunk.trimWhitespace(),chunk.findTags(/`/,/`/),chunk.startTag||chunk.endTag?chunk.endTag&&!chunk.startTag?(chunk.before+=chunk.endTag,chunk.endTag=""):chunk.startTag=chunk.endTag="":(chunk.startTag=chunk.endTag="`",chunk.selection||(chunk.selection=this.getString("codeexample")))},commandProto.doList=function(chunk,postProcessing,isNumberedList){var previousItemsRegex=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,nextItemsRegex=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,bullet="-",num=1,getItemPrefix=function(){var prefix;return isNumberedList?(prefix=" "+num+". ",num++):prefix=" "+bullet+" ",prefix},getPrefixedItem=function(itemText){return void 0===isNumberedList&&(isNumberedList=/^\s*\d/.test(itemText)),itemText=itemText.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(_){return getItemPrefix()})};if(chunk.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!chunk.before||/\n$/.test(chunk.before)||/^\n/.test(chunk.startTag)||(chunk.before+=chunk.startTag,chunk.startTag=""),chunk.startTag){var hasDigits=/\d+[.]/.test(chunk.startTag);if(chunk.startTag="",chunk.selection=chunk.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(chunk),chunk.skipLines(),hasDigits&&(chunk.after=chunk.after.replace(nextItemsRegex,getPrefixedItem)),isNumberedList==hasDigits)return}var nLinesUp=1;chunk.before=chunk.before.replace(previousItemsRegex,function(itemText){return/^\s*([*+-])/.test(itemText)&&(bullet=re.$1),nLinesUp=/[^\n]\n\n[^\n]/.test(itemText)?1:0,getPrefixedItem(itemText)}),chunk.selection||(chunk.selection=this.getString("litem"));var prefix=getItemPrefix(),nLinesDown=1;chunk.after=chunk.after.replace(nextItemsRegex,function(itemText){return nLinesDown=/[^\n]\n\n[^\n]/.test(itemText)?1:0,getPrefixedItem(itemText)}),chunk.trimWhitespace(!0),chunk.skipLines(nLinesUp,nLinesDown,!0),chunk.startTag=prefix;var spaces=prefix.replace(/./g," ");this.wrap(chunk,SETTINGS.lineLength-spaces.length),chunk.selection=chunk.selection.replace(/\n/g,"\n"+spaces)},commandProto.doHeading=function(chunk,postProcessing){if(chunk.selection=chunk.selection.replace(/\s+/g," "),chunk.selection=chunk.selection.replace(/(^\s+|\s+$)/g,""),!chunk.selection)return chunk.startTag="## ",chunk.selection=this.getString("headingexample"),void(chunk.endTag=" ##");var headerLevel=0;chunk.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(chunk.startTag)&&(headerLevel=re.lastMatch.length),chunk.startTag=chunk.endTag="",chunk.findTags(null,/\s?(-+|=+)/),/=+/.test(chunk.endTag)&&(headerLevel=1),/-+/.test(chunk.endTag)&&(headerLevel=2),chunk.startTag=chunk.endTag="",chunk.skipLines(1,1);var headerLevelToCreate=0==headerLevel?2:headerLevel-1;if(headerLevelToCreate>0){var headerChar=headerLevelToCreate>=2?"-":"=",len=chunk.selection.length;for(len>SETTINGS.lineLength&&(len=SETTINGS.lineLength),chunk.endTag="\n";len--;)chunk.endTag+=headerChar}},commandProto.doHorizontalRule=function(chunk,postProcessing){chunk.startTag="----------\n",chunk.selection="",chunk.skipLines(2,1,!0)}}();
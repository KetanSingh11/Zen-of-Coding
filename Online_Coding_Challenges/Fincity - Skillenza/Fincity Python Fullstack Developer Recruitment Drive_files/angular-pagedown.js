function removeMd(md,options){options=options||{},options.listUnicodeChar=!!options.hasOwnProperty("listUnicodeChar")&&options.listUnicodeChar,options.stripListLeaders=!options.hasOwnProperty("stripListLeaders")||options.stripListLeaders,options.gfm=!options.hasOwnProperty("gfm")||options.gfm;var output=md||"";output=output.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*$/gm,"");try{options.stripListLeaders&&(output=options.listUnicodeChar?output.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,options.listUnicodeChar+" $1"):output.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),options.gfm&&(output=output.replace(/\n={2,}/g,"\n").replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/`{3}.*\n/g,"")),output=output.replace(/<[^>]*>/g,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[.*?\][\[\(].*?[\]\)]/g,"").replace(/\[(.*?)\][\[\(].*?[\]\)]/g,"$1").replace(/^\s{0,3}>\s?/g,"").replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} {0,}(\n)?\s{0,}$/gm,"$1$2$3").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/\n{2,}/g,"\n\n").replace(/\s+/g," ").replace(/ +/g," ").trim()}catch(e){return md}return output}var mdExtraOptions={extensions:"all",table_class:"table"};angular.module("ui.pagedown",[]).directive("pagedownEditor",["$compile","$timeout","$window","$q","$modal","ModalService",function($compile,$timeout,$window,$q,$modal,ModalService){var nextId=0,converter=Markdown.getSanitizingConverter();return MathJax.Hub.Config({"HTML-CSS":{preferredFont:"TeX",availableFonts:["STIX","TeX"],linebreaks:{automatic:!0},EqnChunk:MathJax.Hub.Browser.isMobile?10:50},tex2jax:{inlineMath:[["$","$"]],displayMath:[["$$","$$"],["$$$","$$$"]],processEscapes:!0,ignoreClass:"tex2jax_ignore|dno"},TeX:{noUndefined:{attributes:{mathcolor:"red",mathbackground:"#FFEEEE",mathsize:"90%"}},Macros:{href:["#2",2]}},messageStyle:"none",showProcessingMessages:!1,skipStartupTypeset:!0}),Markdown.Extra.init(converter,mdExtraOptions),converter.hooks.chain("preBlockGamut",function(text,rbg){return text.replace(/^ {0,3}""" *\n((?:.*?\n)+?) {0,3}""" *$/gm,function(whole,inner){return"<blockquote>"+rbg(inner)+"</blockquote>\n"})}),{restrict:"E",scope:{content:"=",placeholder:"@",showPreview:"@",help:"&",insertImage:"&",editorClass:"=",editorRows:"@",previewClass:"=",previewContent:"="},link:function(scope,element,attrs){var editorUniqueId;editorUniqueId=null==attrs.id?nextId++:attrs.id;var previewHiddenStyle="false"==scope.showPreview?"display: none;":"",placeholder=attrs.placeholder||"",editorRows=attrs.editorRows||"10",newElement=$compile('<div><div class="wmd-panel"><div id="wmd-button-bar-'+editorUniqueId+'"></div><textarea id="wmd-input-'+editorUniqueId+'" placeholder="'+placeholder+'" ng-model="content" rows="'+editorRows+'" '+(scope.editorClass?'ng-class="editorClass"':'class="wmd-input"')+'></textarea></div><div id="wmd-preview-'+editorUniqueId+'" style="'+previewHiddenStyle+'" '+(scope.previewClass?'ng-class="previewClass"':'class="wmd-panel wmd-preview"')+"></div></div>")(scope);element.append(newElement);var help=angular.isFunction(scope.help)?scope.help:function(){$window.open("http://daringfireball.net/projects/markdown/syntax","_blank")},editor=new Markdown.Editor(converter,"-"+editorUniqueId,{handler:help});scope.previewContent&&converter.hooks.chain("postConversion",function(text){scope.previewContent=text});var editorElement=angular.element(document.getElementById("wmd-input-"+editorUniqueId));"false"!=scope.showPreview&&scope.$watch("content",function(){editor.refreshPreview()}),editor.hooks.chain("onPreviewRefresh",function(){$timeout(function(){(new MJPD).Editing.prepareWmdForMathJax(editor,editorUniqueId,[["$","$"],["$$","$$"]]),scope.content=editorElement.val()})}),angular.isFunction(scope.insertImage)&&editor.hooks.set("insertImageDialog",function(callback){ModalService.showModal({templateUrl:"views/insert_image_modal.addcb285.html",controller:"ComplexController",inputs:{title:"PageDown Image URL Modal"}}).then(function(modal){modal.element.modal(),modal.close.then(function(userURL){userURL.url?$q.when(userURL.url).then(function(imgUrl){callback(userURL.url)},function(reason){callback(null)}):callback(null)})});return!0}),editor.run()}}}]).directive("pagedownViewer",["$compile","$sce","$sanitize",function($compile,$sce,$sanitize){var converter=Markdown.getSanitizingConverter();return MathJax.Hub.Config({"HTML-CSS":{preferredFont:"TeX",availableFonts:["STIX","TeX"],linebreaks:{automatic:!0},EqnChunk:MathJax.Hub.Browser.isMobile?10:50},tex2jax:{inlineMath:[["$","$"]],displayMath:[["$$","$$"],["$$$","$$$"]],processEscapes:!0,ignoreClass:"tex2jax_ignore|dno"},TeX:{noUndefined:{attributes:{mathcolor:"red",mathbackground:"#FFEEEE",mathsize:"90%"}},Macros:{href:["#2",2]}},messageStyle:"none",skipStartupTypeset:!0}),Markdown.Extra.init(converter,mdExtraOptions),{restrict:"E",scope:{content:"="},link:function(scope,element,attrs){var run=function(){if(!scope.content)return void(scope.sanitizedContent="");MathJax.Hub.Queue(["Typeset",MathJax.Hub,String(element[0])]),scope.sanitizedContent=$sce.trustAsHtml(converter.makeHtml(scope.content))};scope.$watch("content",run),run();var newElementHtml="<p ng-bind-html='sanitizedContent'></p>",newElement=$compile(newElementHtml)(scope);element.append(newElement),MathJax.Hub.Queue(["Typeset",MathJax.Hub,String(element[0])])}}}]);